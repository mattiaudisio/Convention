# Jade - 模板引擎

Jade 是一个高性能的模板引擎，它深受 [Haml](http://haml-lang.com) 影响，它是用 JavaScript 实现的, 并且可以供 [Node](http://nodejs.org) 使用.

翻译: [草依山](http://jser.me) 等

## 声明

从 Jade `v0.31.0` 开始放弃了对于 `<script>` 和 `<style>` 标签的平文本支持. 这个问题你可以在 `<script> <style>` 标签后加上 `.` 来解决.

希望这一点能让 Jade 对新手更友好, 同时也不影响到 Jade 本身的能力或者导致过度冗长.

如果你有大量的文件需要转换你可以用下 [fix-jade](https://github.com/ForbesLindesay/fix-jade) 尝试自动完成这个过程.

## Test drive

你可以在网上[试玩 Jade](http://naltatis.github.com/jade-syntax-docs).

## README 目录

- [特性](#a1)
- [其它实现](#a2)
- [安装](#a3)
- [浏览器支持](#a4)
- [公开 API](#a5)
- [语法](#a6)
    - [行结束标志](#a6-1)
    - [标签](#a6-2)
    - [标签文本](#a6-3)
    - [注释](#a6-4)
    - [块注释](#a6-5)
    - [内联](#a6-6)
    - [块展开](#a6-7)
    - [Case](#a6-8)
    - [属性](#a6-9)
    - [HTML](#a6-10)
    - [Doctypes](#a6-11)
- [过滤器](#a7)
- [代码](#a8)
- [循环](#a9)
- [条件语句](#a10)
- [模板继承](#a11)
- [Block append/prepend](#a12)
- [包含](#a13)
- [Mixins](#a14)
- [产生输出](#a15)
- [Makefile 的一个例子](#a16)
- [命令行的 Jade](#a17)
- [教程](#a18)
- [License](#a19)

<a name="a1"/>
## 特性

  - 客户端支持
  - 代码高可读
  - 灵活的缩进
  - 块展开
  - Mixins
  - 静态包含
  - 属性改写
  - 安全，默认代码是转义的
  - 运行时和编译时上下文错误报告 
  - 命令行下编译jade模板
  - HTML5 模式 (使用 ~~`!!! 5`~~ `doctype html` 文档类型)
  - 在内存中缓存(可选)
  - 合并动态和静态标签类
  - 可以通过 `filters` 修改树
  - 模板继承
  - 原生支持 [Express JS](http://expressjs.com) 
  - 通过 `each` 枚举对象、数组甚至是不能枚举的对象
  - 块注释
  - 没有前缀的标签
  - AST Filters
  - 过滤器
    - `:stylus` 必须已经安装 [stylus](http://github.com/LearnBoost/stylus)
    - `:less` 必须已经安装 [less.js](http://github.com/cloudhead/less.js) 
    - `:markdown` 必须已经安装 [markdown-js](http://github.com/evilstreak/markdown-js) 或者 [node-discount](http://github.com/visionmedia/node-discount) 
    - `:cdata`
    - `:coffeescript` 必须已经安装[coffee-script](http://jashkenas.github.com/coffee-script/) 
  - [Emacs Mode](https://github.com/brianc/jade-mode)
  - [Vim Syntax](https://github.com/digitaltoad/vim-jade)
  - [TextMate Bundle](http://github.com/miksago/jade-tmbundle)
  - [Coda/SubEtha syntax Mode](https://github.com/aaronmccall/jade.mode)
  - [Screencasts](http://tjholowaychuk.com/post/1004255394/jade-screencast-template-engine-for-nodejs)
  - [html2jade](https://github.com/donpark/html2jade) converter

<a name="a2"/>
## 其它实现

  - [php](http://github.com/everzet/jade.php)
  - [scala](http://scalate.fusesource.org/versions/snapshot/documentation/scaml-reference.html)
  - [ruby](https://github.com/slim-template/slim)
  - [python](https://github.com/SyrusAkbary/pyjade)
  - [java](https://github.com/neuland/jade4j)

<a name="a3"/>
## 安装

通过 NPM:

```sh
npm install jade
```

<a name="a4"/>
## 浏览器支持

把 Jade 编译为一个可供浏览器使用的单文件，只需要简单的执行:

```sh 
$ make jade.js
```

如果你已经安装了 uglifyjs (`npm install uglify-js`)，你可以执行下面的命令它会生成所有的文件。其实每一个正式版本里都帮你做了这事。 
 
```sh
make jade.min.js
```

默认情况下，为了方便调试Jade会把模板组织成带有形如 `__.lineno = 3` 的行号的形式。 
在浏览器里使用的时候，你可以通过传递一个选项 `{ compileDebug: false }` 来去掉这个。
下面的模板

```sh
p Hello #{name}
```

会被翻译成下面的函数：

```js
function anonymous(locals, attrs, escape, rethrow) {
  var buf = [];
  with (locals || {}) {
    var interp;
    buf.push('\n<p>Hello ' + escape((interp = name) == null ? '' : interp) + '\n</p>');
  }
  return buf.join("");
}
```

通过使用 Jade 的 `./runtime.js`你可以在浏览器使用这些预编译的模板而不需要使用 Jade, 你只需要使用 `runtime.js` 里的工具函数, 它们会放在 `jade.attrs`, `jade.escape` 这些里。 把选项 `{ client: true }` 传递给 `jade.compile()`, Jade 会把这些帮助函数的引用放在`jade.attrs`, `jade.escape`.

```js
function anonymous(locals, attrs, escape, rethrow) {
  var attrs = jade.attrs, escape = jade.escape, rethrow = jade.rethrow;
  var buf = [];
  with (locals || {}) {
    var interp;
    buf.push('\n<p>Hello ' + escape((interp = name) == null ? '' : interp) + '\n</p>');
  }
  return buf.join("");
}
```

<a name="a5"/>
## 公开 API

```javascript
var jade = require('jade');

// Compile a function
var fn = jade.compile('string of jade', options);
fn(locals);
```

### 选项

 - `self`      使用 `self` 命名空间来持有本地变量. _(默认为 `false`)_
 - `locals`    本地变量对象
 - `filename`  异常发生时使用，includes 时必需
 - `debug`     输出 token 和翻译后的函数体
 - `compiler`  替换掉 jade 默认的编译器
 - `compileDebug`  `false`的时候调试的结构不会被输出
 - `pretty`    为输出加上了漂亮的空格缩进 _(默认为 `false`)_

<a name="a6"/>
## 语法 

<a name="a6-1"/>
### 行结束标志

**CRLF** 和 **CR** 会在编译之前被转换为 **LF** 

<a name="a6-2"/>
### 标签

标签就是一个简单的单词:

```jade
html
```

它会被转换为 `<html></html>`

标签也是可以有 id 的:

```jade
div#container
```

它会被转换为 `<div id="container"></div>`

怎么加 class 呢？

```jade
div.user-details
```

转换为 `<div class="user-details"></div>`

多个 class 和 id? 也是可以搞定的:

    div#foo.bar.baz

转换为 `<div id="foo" class="bar baz"></div>`

不停的 `div div div` 很讨厌啊 , 可以这样:

```jade
#foo
.bar
```

这个算是我们的语法糖，它已经被很好的支持了，上面的会输出：

```html
<div id="foo"></div><div class="bar"></div>
```

<a name="a6-3"/>
### 标签文本 

只需要简单的把内容放在标签之后：

```jade
p wahoo!
```

它会被渲染为 `<p>wahoo!</p>`.

很帅吧，但是大段的文本怎么办呢：

```jade
p
  | foo bar baz
  | rawr rawr
  | super cool
  | go jade go
```

渲染为 `<p>foo bar baz rawr.....</p>`

怎么和数据结合起来？ 所有类型的文本展示都可以和数据结合起来，如果我们把 `{ name: 'tj', email: 'tj@vision-media.ca' }` 传给编译函数，下面是模板上的写法:

```jade
#user #{name} &lt;#{email}&gt;
```

它会被渲染为 `<div id="user">tj &lt;tj@vision-media.ca&gt;</div>`

当就是要输出 `#{}` 的时候怎么办? 转义一下!

    p \#{something}

它会输出 `<p>#{something}</p>`

同样可以使用非转义的变量 `!{html}`, 下面的模板将直接输出一个 `<script>` 标签:

```jade
- var html = "<script></script>"
| !{html}
```

内联标签同样可以使用文本块来包含文本：

```jade
label
  | Username:
  input(name='user[name]')
```

或者直接使用标签文本:

```jade
label Username:
  input(name='user[name]')
```

_只_ 包含文本的标签，比如 `<script>`, `<style>`, 和 `<textarea>` 不需要前缀 `|` 字符, 比如:

```jade
html
  head
    title Example
    script
      if (foo) {
        bar();
      } else {
        baz();
      }
```

这里还有一种选择，可以使用 `.` 来开始一段文本块，比如：

```jade
p.
  foo asdf
  asdf
   asdfasdfaf
   asdf
  asd.
```

会被渲染为:

```jade
<p>foo asdf
asdf
  asdfasdfaf
  asdf
asd
.
</p>
```

这和带一个空格的 `.` 是不一样的, 带空格的会被 Jade 的解析器忽略，当作一个普通的文字: 

```jade
p .
```
    
渲染为:

```jade
<p>.</p>
```

需要注意的是文本块需要两次转义。比如想要输出下面的文本：

```jade
<p>foo\bar</p>
```

使用:

```jade
p.
  foo\\bar
```

<a name="a6-4"/>
### 注释

单行注释和 JavaScript 里是一样的，通过 `//` 来开始，并且必须单独一行：

```jade
// just some paragraphs
p foo
p bar
```

渲染为：

```html
<!-- just some paragraphs -->
<p>foo</p>
<p>bar</p>
```

Jade 同样支持不输出的注释，加一个短横线就行了：

```jade
//- will not output within markup
p foo
p bar
```

渲染为：

```html
<p>foo</p>
<p>bar</p>
```

<a name="a6-5"/>
### 块注释

块注释也是支持的：

```jade
body
  //
    #content
      h1 Example
```

渲染为：

```html
<body>
  <!--
  <div id="content">
    <h1>Example</h1>
  </div>
  -->
</body>
```

Jade 同样很好的支持了条件注释：

```jade
body
  //if IE
    a(href='http://www.mozilla.com/en-US/firefox/') Get Firefox
```

渲染为：

```html
<body>
  <!--[if IE]>
    <a href="http://www.mozilla.com/en-US/firefox/">Get Firefox</a>
  <![endif]-->
</body>
```

<a name="a6-6"/>
### 内联

Jade 支持以自然的方式定义标签嵌套:

```jade
ul
  li.first
    a(href='#') foo
  li
    a(href='#') bar
  li.last
    a(href='#') baz
```

<a name="a6-7"/>
### 块展开 

块展开可以帮助你在一行内创建嵌套的标签，下面的例子和上面的是一样的：

```jade
ul
  li.first: a(href='#') foo
  li: a(href='#') bar
  li.last: a(href='#') baz
```

<a name="a6-8"/>
### Case

`case` 表达式按下面这样的形式写:

```jade
html
  body
    friends = 10
    case friends
      when 0
        p you have no friends
      when 1
        p you have a friend
      default
        p you have #{friends} friends
```

块展开在这里也可以使用:

```jade
friends = 5

html
  body
    case friends
      when 0: p you have no friends
      when 1: p you have a friend
      default: p you have #{friends} friends
```

<a name="a6-9"/>
### 属性

Jade 现在支持使用 `(` 和 `)` 作为属性分隔符

```jade
a(href='/login', title='View login page') Login
```

当一个值是 `undefined` 或者 `null` 属性 _不_ 会被加上,
所以呢，它不会编译出 'something="null"'.

```jade
div(something=null)
```

Boolean 属性也是支持的:

```jade
input(type="checkbox", checked)
```

使用代码的 Boolean 属性只有当属性为 `true` 时才会输出：

```jade
input(type="checkbox", checked=someValue)
```
    
多行同样也是可用的：

```jade
input(type='checkbox',
  name='agreement',
  checked)
```

多行的时候可以不加逗号：

```jade
input(type='checkbox'
  name='agreement'
  checked)
```

加点空格，格式好看一点？同样支持

```jade
input(
  type='checkbox'
  name='agreement'
  checked)
```

冒号也是支持的:

```jade
rss(xmlns:atom="atom")
```

假如我有一个 `user` 对象 `{ id: 12, name: 'tobi' }`
我们希望创建一个指向 `/user/12` 的链接 `href`, 我们可以使用普通的 JavaScript 字符串连接，如下:

```jade
a(href='/user/' + user.id)= user.name
```

或者我们使用 Jade 的修改方式, 这个我想很多使用 Ruby 或者 CoffeeScript 的人会看起来像普通的 JS..:

```jade
a(href='/user/#{user.id}')= user.name
```

`class` 属性是一个特殊的属性，你可以直接传递一个数组，比如 `bodyClasses = ['user', 'authenticated']` :

```jade
body(class=bodyClasses)
```

<a name="a6-10"/>
### HTML

内联的 HTML 是可以的，我们可以使用管道定义一段文本 :

```jade
html
  body
    | <h1>Title</h1>
    | <p>foo bar baz</p>
```

或者我们可以使用 `.` 来告诉 Jade 我们需要一段文本：

```jade
html
  body.
    <h1>Title</h1>
    <p>foo bar baz</p>
```

上面的两个例子都会渲染成相同的结果：

```jade
<html><body><h1>Title</h1>
<p>foo bar baz</p>
</body></html>
```

 这条规则适应于在 Jade 里的任何文本：

```
html
  body
    h1 User <em>#{name}</em>
```

<a name="a6-11"/>
### Doctypes

添加文档类型只需要简单的使用 `!!!`, 或者 `doctype` 跟上下面的可选项:

```jade
!!!
```

会渲染出 _transitional_ 文档类型, 或者:

```jade
!!! 5
```

或

```jade
!!! html
```

或

```jade
doctype html
```

Doctype 是大小写不敏感的, 所以下面两个是一样的:

```jade
doctype Basic
doctype basic
```

当然也是可以直接传递一段文档类型的文本：

```jade
doctype html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN"
```

渲染后:

```html
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN">
```

会输出 _HTML5_ 文档类型. 下面的默认的文档类型，可以很简单的扩展：

```javascript
var doctypes = exports.doctypes = {
  '5': '<!DOCTYPE html>',
  'xml': '<?xml version="1.0" encoding="utf-8" ?>',
  'default': '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',
  'transitional': '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',
  'strict': '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',
  'frameset': '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">',
  '1.1': '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">',
  'basic': '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN" "http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd">',
  'mobile': '<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN" "http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">'
};
```

通过下面的代码可以很简单的改变默认的文档类型：

```javascript
    jade.doctypes.default = 'whatever you want';
```

<a name="a7"/>
## 过滤器

过滤器前缀 `:`, 比如 `:markdown` 会把下面块里的文本交给专门的函数进行处理。查看顶部 _特性_ 里有哪些可用的过滤器。

```jade
body
  :markdown
    Woah! jade _and_ markdown, very **cool**
    we can even link to [stuff](http://google.com)
```

渲染为:

```html
<body><p>Woah! jade <em>and</em> markdown, very <strong>cool</strong> we can even link to <a href="http://google.com">stuff</a></p></body>
```

<a name="a8"/>
## 代码

Jade 目前支持三种类型的可执行代码。第一种是前缀 `-`， 这是不会被输出的：

```jade
- var foo = 'bar';
```

这可以用在条件语句或者循环中：

```jade
- for (var key in obj)
  p= obj[key]
```

由于 Jade 的缓存技术，下面的代码也是可以的：

```jade
- if (foo)
  ul
    li yay
    li foo
    li worked
- else
  p oh no! didnt work
```

哈哈，甚至是很长的循环也是可以的：

    - if (items.length)
      ul
        - items.forEach(function(item){
          li= item
        - })

所以你想要的！

下一步我们要 _转义_ 输出的代码，比如我们返回一个值，只要前缀一个 `=`：   

```jade
- var foo = 'bar'
= foo
h1= foo
```

它会渲染为 `bar<h1>bar</h1>`. 为了安全起见，使用 `=` 输出的代码默认是转义的,如果想直接输出不转义的值可以使用 `!=`：

```jade
p!= aVarContainingMoreHTML
```

Jade 同样是设计师友好的，它可以使 JavaScript 更直接更富表现力。比如下面的赋值语句是相等的，同时表达式还是通常的 JavaScript：

```jade
- var foo = 'foo ' + 'bar'
foo = 'foo ' + 'bar'
```

Jade 会把 `if`, `else if`, `else`, `until`, `while`, `unless` 同别的优先对待, 但是你得记住它们还是普通的 JavaScript：

```jade
if foo == 'bar'
  ul
    li yay
    li foo
    li worked
else
  p oh no! didnt work  
```

<a name="a9"/>
## 循环

尽管已经支持 JavaScript 原生代码，Jade 还是支持了一些特殊的标签，它们可以让模板更加易于理解，其中之一就是 `each`, 这种形式：

```jade
each VAL[, KEY] in OBJ
```

一个遍历数组的例子 ：

```jade
- var items = ["one", "two", "three"]
each item in items
  li= item
```

渲染为:

```html
<li>one</li>
<li>two</li>
<li>three</li>
```

遍历一个数组同时带上索引：

```jade
items = ["one", "two", "three"]
each item, i in items
  li #{item}: #{i}
```

渲染为:

```html
<li>one